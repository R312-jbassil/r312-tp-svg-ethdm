---
import PocketBase from "../../utils/pb";
import { Collections } from "../../utils/pocketbase-types";
import Layout from "../../layouts/Layout.astro";

const pb = PocketBase;

let svgs = [];

try {
    svgs = await pb.collection(Collections.Svg).getFullList(200, {
        sort: "-created",
    });
} catch (error) {
    console.error("Erreur lors de la récupération des SVGs :", error);
}

const user = await pb.authStore.model;
let svglist = [];

if (user) {
    svgs = await pb.collection(Collections.Svg).getFullList({
        sort: "-created",
        filter: `user = "${user.id}"`,
    });
} else {
    svgs = await pb.collection(Collections.Svg).getFullList({
        sort: "-created",
    });
}
---

<Layout>
    <a class="btn btn-primary mb-4" href="/generator">← Retour au générateur</a>
    <h1 class="text-3xl font-bold text-center mb-8">Galerie des SVG</h1>

    {
        svgs.length > 0 ? (
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                {svgs.map((svg) => (
                    <div
                        class="card bg-base-100 shadow-md hover:shadow-lg transition-shadow cursor-pointer border border-base-300"
                        data-svg-id={svg.id}
                    >
                        <div class="card-body p-4">
                            <h2 class="card-title text-lg">{svg?.title}</h2>
                            <div class="flex justify-center my-4" set:html={svg?.code_svg} />
                            <div class="card-actions justify-center">
                                <span class="badge badge-outline badge-sm">
                                    Cliquez pour voir l'historique
                                </span>
                            </div>
                        </div>
                    </div>
                ))}
            </div>
        ) : (
            <div class="alert alert-info">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <span>Aucun SVG disponible.</span>
            </div>
        )
    }
</Layout>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const cards = document.querySelectorAll(".card[data-svg-id]");

        cards.forEach((card) => {
            card.addEventListener("click", () => {
                const svgId = card.getAttribute("data-svg-id");
                if (svgId) {
                    window.location.href = `/gallery/${svgId}`;
                }
            });
        });
    });
</script>
