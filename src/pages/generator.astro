---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Générateur IA">
  <main class="container">
    <div class="generator-interface">

      <script>
        //@ts-nocheck

        async function generateSVG(prompt) {
          const res = await fetch('/api/generateSVG', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt }),
          });
          const data = await res.json();
          return data.svg;
        }

        async function handleSubmit() {
            
          let prompt = "";
          let svgCode = "";
          const promptElement = document.getElementById("user-prompt");
          prompt = promptElement ? promptElement.value : "";
          const svgContainer = document.getElementById("svg-container");
          let svgOutput = document.getElementById("svg-output");
          svgCode = await generateSVG(prompt);
          svgOutput.textContent = svgCode;
          svgContainer.innerHTML = `<span class="loading loading-ring loading-xl"></span>`;
generateButton.disabled = true;
          svgContainer.innerHTML = svgCode;
          generateButton.disabled = false;
        }

        const generateButton = document.getElementById("generate-button");
        if (generateButton) {
          generateButton.addEventListener("click", handleSubmit);
        }
      </script>

      <div class="min-h-screen bg-base-100 text-base-content font-sans">
        <div class="container mx-auto p-5 max-w-6xl">
          <h1 class="text-center text-2xl font-bold mb-5">SVG Generator</h1>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-5 min-h-[300px]">
            <div class="bg-neutral text-neutral-content p-4">
              <div id="svg-container" class="bg-base-100 h-full p-4 border border-base-300 flex items-center justify-center text-center">
                <span class="placeholder opacity-70 italic">Preview</span>
              </div>
            </div>

            <div class="bg-neutral p-4 text-neutral-content">
              <div class="bg-neutral text-neutral-content font-mono text-xs leading-snug overflow-auto p-3 h-full">
                <code id="svg-output" class="block whitespace-pre">/* SVG Code */</code>
              </div>
            </div>
          </div>

          <div class="space-y-4">
            <div class="form-control">
              <label for="user-prompt" class="label">
                <span class="label-text font-semibold">Prompt</span>
              </label>
              <textarea id="user-prompt" class="textarea textarea-bordered w-full h-28 font-mono"></textarea>
            </div>

            <div class="flex flex-col md:flex-row gap-3 items-center bg-base-200 p-4 border border-base-300 mt-5">
              <button id="generate-button" class="btn btn-neutral">Generate</button>
            </div>

            <div class="result-box bg-base-200 p-3 border-l-4 border-neutral mt-4 text-sm">
              Génère SVG...
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</Layout>
